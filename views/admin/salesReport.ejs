<%- include('../layouts/admin_header.ejs') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Report</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center mb-4">Sales Report</h1>

    <!-- Sorting Options -->
    <div class="d-flex justify-content-between mb-4">
      <div>
        <button class="btn btn-primary sort-btn" data-sort="day">Day</button>
        <button class="btn btn-primary sort-btn" data-sort="week">Week</button>
        <button class="btn btn-primary sort-btn" data-sort="month">Month</button>
      </div>

      <div>
        <input
          type="date"
          id="filter-date"
          class="form-control"
          style="width: auto; display: inline-block;"
        />
        <button id="filter-btn" class="btn btn-secondary">Filter</button>
      </div>
    </div>
    
    <div style="width: 300px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); font-family: Arial, sans-serif; margin: 20px 0;">
    <table style="width: 100%; border-collapse: collapse; text-align: left;">
        <tr>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;">Total Sale</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%=length %></td>
        </tr>
        <tr>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;">Total Order Amount</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%=sum %></td>
        </tr>
        <tr>
          <td style="padding: 8px;">Total Discount</td>
          <td style="padding: 8px; text-align: right;"><%=totalOffer %></td>
        </tr>
      </table>
    </div>


    <div class="mb-4">
      <label for="format" class="form-label">Format:</label>
      <select id="format" class="form-select">
          <option value="pdf">PDF</option>
          <option value="xlsx">Excel</option>
      </select>
      <button id="btnDownload" class="btn btn-dark mt-2">Download Report</button>
  </div>
    

    <!-- Sales Report Table -->
    <div class="table-responsive">
      <table class="table table-bordered table">
        <thead>
          <tr>
            <th>NO</th>
            <th>OrderId</th>
            <th>Order Amount</th>
            <th>Coupen Offer</th>
            <th>Status</th>
            <th>Payment Method</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="sales-report">
          <% salesData.forEach((item, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><strong> <%= item._id %> </strong></td>
            <td><%= item.totalAmount %></td>
            <td><%= item.couponDiscount %></td>
            <td><%= item.paymentStatus %></td>
            <td><%= item.paymentMethod %></td>
            <td><%= new Date(item.orderDate).toLocaleDateString('en-US') %></td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
 
  <script>

  document.getElementById('btnDownload').addEventListener('click', () => {
  const format = document.getElementById('format').value;
  if (format === 'pdf') {
    window.location.href = '/admin/sales-report/download/pdf';
  } else if (format === 'xlsx') {
    window.location.href = '/admin/sales-report/download/excel';
  }
  });




    document.addEventListener("DOMContentLoaded", function () {
      // Sorting Buttons
      const sortButtons = document.querySelectorAll(".sort-btn");
      const filterBtn = document.getElementById("filter-btn");
      const filterDateInput = document.getElementById("filter-date");
      const btnDownload = document.getElementById('btnDownload');
      const formatSelect = document.getElementById('format');
            

      sortButtons.forEach(button => {
        button.addEventListener("click", () => {
          const sortType = button.getAttribute("data-sort");
          window.location.href = `/admin/sales-report?sort=${sortType}`;
        });
      });

      // Filter by Date
      filterBtn.addEventListener("click", () => {
        const filterDate = filterDateInput.value;
        if (filterDate) {
          window.location.href = `/admin/sales-report?filterDate=${filterDate}`;
        }
      });
    });
  </script>
</body>
</html>

<%- include('../layouts/admin_footer.ejs') %>
